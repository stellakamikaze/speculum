{% extends "base.html" %}

{% block title %}Login — Speculum{% endblock %}

{% block content %}
<div class="login-page">
    <div class="login-container">
        <!-- Left side: Branding -->
        <div class="login-brand">
            <div class="login-brand-content">
                <span class="login-number">01.</span>
                <h1 class="login-title">
                    <span class="login-title-line">Accedi</span>
                    <span class="login-title-line login-title-accent">all'Archivio</span>
                </h1>
                <p class="login-tagline">Sistema di archiviazione e mirror per la preservazione digitale</p>
            </div>
            <div class="login-decoration">
                <div class="login-grid"></div>
            </div>
        </div>

        <!-- Right side: Form -->
        <div class="login-form-wrapper">
            <form method="POST" class="login-form" id="loginForm">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                {% if error %}
                <div class="login-error" role="alert">
                    <span class="login-error-icon">!</span>
                    <span class="login-error-text">{{ error }}</span>
                </div>
                {% endif %}

                <div class="login-field">
                    <label class="login-label" for="username">
                        <span class="login-label-text">Username</span>
                        <span class="login-label-required">*</span>
                    </label>
                    <div class="login-input-wrapper">
                        <input
                            type="text"
                            name="username"
                            id="username"
                            class="login-input"
                            required
                            autofocus
                            autocomplete="username"
                            placeholder="Inserisci username"
                        >
                        <span class="login-input-focus"></span>
                    </div>
                </div>

                <div class="login-field">
                    <label class="login-label" for="password">
                        <span class="login-label-text">Password</span>
                        <span class="login-label-required">*</span>
                    </label>
                    <div class="login-input-wrapper login-input-password">
                        <input
                            type="password"
                            name="password"
                            id="password"
                            class="login-input"
                            required
                            autocomplete="current-password"
                            placeholder="Inserisci password"
                        >
                        <button
                            type="button"
                            class="login-toggle-password"
                            aria-label="Mostra password"
                            onclick="togglePasswordVisibility()"
                        >
                            <span class="eye-icon" id="eyeIcon">◠</span>
                        </button>
                        <span class="login-input-focus"></span>
                    </div>
                </div>

                <button type="submit" class="login-submit" id="loginSubmit">
                    <span class="login-submit-text">Accedi</span>
                    <span class="login-submit-arrow">→</span>
                    <span class="login-submit-loading">
                        <span class="login-spinner"></span>
                    </span>
                </button>
            </form>

            <div class="login-footer">
                <div class="login-divider">
                    <span class="login-divider-line"></span>
                    <span class="login-divider-text">oppure</span>
                    <span class="login-divider-line"></span>
                </div>
                <p class="login-cta">Vuoi richiedere l'archiviazione di un sito?</p>
                <a href="{{ url_for('request_mirror') }}" class="login-link">
                    Richiedi Mirror
                    <span class="login-link-arrow">↗</span>
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Password visibility toggle
    function togglePasswordVisibility() {
        const passwordInput = document.getElementById('password');
        const eyeIcon = document.getElementById('eyeIcon');

        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            eyeIcon.textContent = '◡';
            eyeIcon.parentElement.setAttribute('aria-label', 'Nascondi password');
        } else {
            passwordInput.type = 'password';
            eyeIcon.textContent = '◠';
            eyeIcon.parentElement.setAttribute('aria-label', 'Mostra password');
        }
    }

    // Form submission with loading state
    document.getElementById('loginForm').addEventListener('submit', function(e) {
        const submitBtn = document.getElementById('loginSubmit');
        submitBtn.classList.add('loading');
        submitBtn.disabled = true;
    });

    // Remove loading if page is shown from cache (back button)
    window.addEventListener('pageshow', function(e) {
        if (e.persisted) {
            const submitBtn = document.getElementById('loginSubmit');
            submitBtn.classList.remove('loading');
            submitBtn.disabled = false;
        }
    });

    // Animate error on load if present
    document.addEventListener('DOMContentLoaded', function() {
        const errorEl = document.querySelector('.login-error');
        if (errorEl) {
            errorEl.classList.add('animate');
        }
    });
</script>
{% endblock %}
