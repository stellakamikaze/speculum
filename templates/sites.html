{% extends "base.html" %}

{% block title %}Siti — Speculum{% endblock %}

{% block content %}
<header class="page-header swiss-noise">
    <span class="section-label">Gestione</span>
    <div class="header-row">
        <h1>Tutti i<br>Siti</h1>
        <div class="header-actions">
            <a href="{{ url_for('bulk_add_sites') }}" class="btn btn-secondary">Import massivo</a>
            <a href="{{ url_for('add_site') }}" class="btn btn-primary">Aggiungi sito</a>
        </div>
    </div>

    <div class="filter-tabs">
        <a href="{{ url_for('sites_list', type='all') }}" class="filter-tab {% if filter_type == 'all' %}active{% endif %}">Tutti</a>
        <a href="{{ url_for('sites_list', type='website') }}" class="filter-tab {% if filter_type == 'website' %}active{% endif %}">Siti web</a>
        <a href="{{ url_for('sites_list', type='youtube') }}" class="filter-tab {% if filter_type == 'youtube' %}active{% endif %}">YouTube</a>
    </div>
</header>

{% if sites %}
<div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Tipo</th>
                <th>Categoria</th>
                <th>Stato</th>
                <th>{% if filter_type == 'youtube' %}Video{% else %}Pagine{% endif %}</th>
                <th>Dimensione</th>
                <th>Ultimo crawl</th>
                <th>Azioni</th>
            </tr>
        </thead>
        <tbody>
            {% for site in sites %}
            <tr class="status-row-{{ site.status }}">
                <td><a href="{{ url_for('site_detail', site_id=site.id) }}">{{ site.name }}</a></td>
                <td>
                    {% if site.site_type == 'youtube' %}
                    <span class="type-badge youtube">YouTube</span>
                    {% else %}
                    <span class="type-badge website">Web</span>
                    {% endif %}
                </td>
                <td>{{ site.category.name if site.category else '—' }}</td>
                <td><span class="status-badge status-{{ site.status }}">{{ site.status }}</span></td>
                <td>{{ site.page_count if site.page_count else '—' }}</td>
                <td>{{ site._human_size(site.size_bytes) if site.size_bytes else '—' }}</td>
                <td>{{ site.last_crawl.strftime('%d/%m/%Y %H:%M') if site.last_crawl else 'Mai' }}</td>
                <td class="actions-cell">
                    {% if site.status == 'ready' %}
                        {% if site.site_type == 'youtube' %}
                        <a href="{{ url_for('channel_videos', site_id=site.id) }}" class="btn btn-small">Video</a>
                        {% else %}
                        <a href="{{ url_for('serve_mirror', site_path=site._get_mirror_path()) }}" class="btn btn-small" target="_blank">Apri</a>
                        {% endif %}
                    {% endif %}
                    <a href="{{ url_for('site_detail', site_id=site.id) }}" class="btn btn-small btn-secondary">Dettagli</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="empty-state swiss-dots">
    <p>Nessun sito configurato.</p>
    <a href="{{ url_for('add_site') }}" class="btn btn-primary">Aggiungi il primo sito</a>
</div>
{% endif %}

{% endblock %}
