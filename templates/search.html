{% extends "base.html" %}

{% block title %}Ricerca - Speculum{% endblock %}

{% block oembed_discovery %}
{% if query %}
<link rel="alternate" type="application/json+oembed"
      href="{{ url_for('oembed_endpoint', url=request.url, _external=True) }}"
      title="Ricerca: {{ query }}">
{% endif %}
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Ricerca</h1>
    <p>Cerca nei contenuti archiviati</p>
</div>

<form action="{{ url_for('search_page') }}" method="get" class="search-form">
    <div class="search-input-group">
        <input type="text" name="q" value="{{ query }}" placeholder="Cerca nei siti e video archiviati..." class="search-input" autofocus>
        <button type="submit" class="btn btn-primary">Cerca</button>
    </div>
</form>

{% if query %}
<div class="search-results">
    <p class="results-count">{{ results|length }} risultati per "<strong>{{ query }}</strong>"</p>

    {% if results %}
    <div class="results-list">
        {% for result in results %}
        <div class="result-item result-{{ result.type }}">
            {% if result.type == 'site' %}
            <div class="result-header">
                <span class="result-type-badge">Sito</span>
                {% if result.category %}
                <span class="result-category">{{ result.category }}</span>
                {% endif %}
            </div>
            <h3><a href="{{ url_for('site_detail', site_id=result.site_id) }}">{{ result.name }}</a></h3>
            <p class="result-url">{{ result.url }}</p>
            {% if result.snippet %}
            <p class="result-snippet">{{ result.snippet|safe }}</p>
            {% endif %}

            {% elif result.type == 'video' %}
            <div class="result-header">
                <span class="result-type-badge result-type-video">Video</span>
            </div>
            <h3><a href="{{ url_for('videos_list', site_id=result.site_id) }}">{{ result.title }}</a></h3>
            {% if result.title_snippet %}
            <p class="result-snippet">{{ result.title_snippet|safe }}</p>
            {% endif %}
            {% if result.description_snippet %}
            <p class="result-snippet">{{ result.description_snippet|safe }}</p>
            {% endif %}
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-results">
        <p>Nessun risultato trovato per "<strong>{{ query }}</strong>"</p>
        <p>Prova con parole chiave diverse o meno specifiche.</p>
    </div>
    {% endif %}
</div>
{% else %}
<div class="search-tips">
    <h3>Suggerimenti per la ricerca</h3>
    <ul>
        <li>Usa parole chiave specifiche</li>
        <li>La ricerca include titoli, descrizioni e contenuti delle pagine archiviate</li>
        <li>I video YouTube sono cercabili per titolo e descrizione</li>
    </ul>
</div>
{% endif %}
{% endblock %}

{% block head %}
<style>
.search-form {
    margin-bottom: 2rem;
}
.search-input-group {
    display: flex;
    gap: 0.5rem;
    max-width: 600px;
}
.search-input {
    flex: 1;
    padding: 0.75rem 1rem;
    font-size: 1.1rem;
    border: 2px solid var(--border-color, #ddd);
    border-radius: 4px;
}
.search-input:focus {
    outline: none;
    border-color: var(--accent-color, #007bff);
}
.results-count {
    color: var(--text-muted, #666);
    margin-bottom: 1rem;
}
.results-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}
.result-item {
    padding: 1rem;
    border: 1px solid var(--border-color, #ddd);
    border-radius: 4px;
    background: var(--card-bg, #fff);
}
.result-header {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}
.result-type-badge {
    font-size: 0.75rem;
    padding: 0.2rem 0.5rem;
    border-radius: 3px;
    background: var(--accent-color, #007bff);
    color: white;
}
.result-type-video {
    background: #c00;
}
.result-category {
    font-size: 0.75rem;
    padding: 0.2rem 0.5rem;
    border-radius: 3px;
    background: var(--tag-bg, #eee);
}
.result-item h3 {
    margin: 0 0 0.5rem 0;
}
.result-item h3 a {
    color: var(--link-color, #007bff);
    text-decoration: none;
}
.result-item h3 a:hover {
    text-decoration: underline;
}
.result-url {
    font-size: 0.85rem;
    color: var(--text-muted, #666);
    margin: 0 0 0.5rem 0;
}
.result-snippet {
    margin: 0;
    line-height: 1.5;
}
.result-snippet mark {
    background: #ffeb3b;
    padding: 0 2px;
}
.no-results, .search-tips {
    padding: 2rem;
    text-align: center;
    color: var(--text-muted, #666);
}
.search-tips {
    text-align: left;
    max-width: 500px;
}
.search-tips ul {
    margin-top: 1rem;
}
</style>
{% endblock %}
